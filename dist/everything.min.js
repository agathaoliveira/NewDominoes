var Play;!function(a){a[a.LEFT=0]="LEFT",a[a.RIGHT=1]="RIGHT",a[a.BUY=2]="BUY",a[a.PASS=3]="PASS",a[a.REVEAL=4]="REVEAL",a[a.END=5]="END"}(Play||(Play={}));var gameLogic;!function(a){function b(a,b){a.root=b,a.leftMost=b.tileKey,a.rightMost=b.tileKey}function c(a,b){for(var c=a.rightMost,d=a.root;d.tileKey!==c;)d=d.rightTile;d.rightTile=b,a.rightMost=b.tileKey}function d(a,b){for(var c=a.leftMost,d=a.root;d.tileKey!==c;)d=d.leftTile;d.leftTile=b,a.leftMost=b.tileKey}function e(a,b){a.hand.push(b)}function f(a,b){var c=a.hand.indexOf(b,0);if(void 0===c||-1===c)throw new Error("Unknown array element "+JSON.stringify(b));a.hand.splice(c,1)}function g(a){return a.hand.length}function h(){return{}}function i(a){var b,c,d,e,f,g=[],i=[],j=[],k={id:-1,hand:[]},l=[],m=[],n={keys:[]};f=2===a?7:5,d=0,e=0;var o=0;for(b=0;7>b;b++)for(c=0;b>=c;c++){var p={leftNumber:c,rightNumber:b};a>o?(j[o]||(j[o]={id:o,hand:[]}),j[o].hand.push("tile"+d),m[d]={key:"tile"+d,visibleToPlayerIndexes:[o]},e++,l[d]={key:"tile"+d,value:p},e===f&&(o++,e=0)):(k.hand.push("tile"+d),l[d]={key:"tile"+d,value:p},m[d]={key:"tile"+d,visibleToPlayerIndexes:[]}),g.push({set:l[d]}),i.push({setVisibility:m[d]}),n.keys.push("tile"+d),d++}var q=h();return g.push({setTurn:{turnIndex:0}}),g.push({set:{key:"house",value:k}}),g.push({set:{key:"board",value:q}}),g.push({shuffle:n}),g.push({set:{key:"players",value:j}}),g.concat(i)}function j(a){return 0===g(a)?a.id:void 0}function k(a){for(var b=[],c=0;a>c;c++)b.push(c);return b}function l(a,b,c,d,e){var f=[];return f.push({setTurn:{turnIndex:a}}),f.push({set:{key:"board",value:b}}),f.push({set:{key:"delta",value:c}}),f.push({setVisibility:d}),f.push({set:{key:"players",value:e}}),f}function m(a,b){for(var c,d=0,e=0;e<a.hand.length;e++)c=b[a.hand[e]],d=d+c.leftNumber+c.rightNumber;return d}function n(a,b){if(a.rightNumber!==b.rightNumber&&a.rightNumber!==b.leftNumber&&a.leftNumber!==b.rightNumber&&a.leftNumber!==b.leftNumber)throw new Error("Cannot place tile at the board! Numbers are invalid.")}function o(a,b,c){for(var d=[],e=[],f=a.length,g=336,h=-1,i=0,j=0;f>j;j++)e[j]=m(a[j],b),i+=e[j],e[j]<g&&(g=e[j],h=j);for(var k=[],j=0;f>j;j++)j===h?k[j]=i-2*e[j]:k[j]=0;for(var j=0;28>j;j++)d.push({set:{key:"tile"+j,value:b["tile"+j]}});return d.push({endMatch:{endMatchScores:k}}),d.push({set:{key:"delta",value:c}}),d}function p(a,b,c){var d=[];return d.push({setTurn:{turnIndex:(a+1)%b}}),d.push({set:{key:"delta",value:c}}),d}function q(a,b,c,d){for(var e=[],f=k(a),g=0;28>g;g++)e.push({setVisibility:{key:"tile"+g,visibleToPlayerIndexes:f}});return e.push({setTurn:{turnIndex:b}}),e.push({set:{key:"delta",value:c}}),e.push({set:{key:"players",value:d}}),e}function r(a,b,c,d,h,i,j){var k,m;if(0===g(a))throw new Error("One cannot buy from the house when it has no tiles");return f(a,b),e(c,b),m={key:b,visibleToPlayerIndexes:[j]},d[j]=c,k=l(j,h,i,m,d),k=k.concat([{set:{key:"house",value:a}}])}function s(a,e,h,i,m,o,p,r){for(var s,t=i.length,u={tileKey:m},v=0;t>v;v++)if(j(i[v])===i[v].id)throw new Error("Can only make a move if the game is not over! Player "+v+" has already won.");if(a.root)if(p===Play.RIGHT){var w=r[m],x=r[a.rightMost];n(w,x),c(a,u)}else{var w=r[m],y=r[a.leftMost];n(w,y),d(a,u)}else{var w=r[m];if(w.leftNumber!=w.rightNumber)throw new Error("First tile must be a double");b(a,u)}if(f(h,m),i[o]=h,0!==g(h)){s={key:m,visibleToPlayerIndexes:k(t)};var z=(o+1)%t;return l(z,a,e,s,i)}return e.play=Play.REVEAL,q(t,o,e,i)}function t(a,b,c,d){var e,f,g,h,i=c?c.tileKey:void 0,j=void 0===c?void 0:c.play,k=a.players,l=a.house,m=a.board;if(e=angular.copy(m),f=angular.copy(k),g=angular.copy(k[b]),h=angular.copy(l),Play.LEFT===j||Play.RIGHT===j)return s(e,c,g,f,i,b,j,d);if(Play.BUY===j)return r(h,i,g,f,e,c,b);if(Play.PASS==j)return p(b,f.length,c);if(Play.REVEAL===j)return q(f.length,b,c,d.players);if(Play.END===j)return o(f,d,c);throw new Error("Unknown play")}function u(a){var b=a.move,c=a.turnIndexBeforeMove,d=a.stateBeforeMove,e=a.numberOfPlayers;try{if(e>4)throw Error("A maximum of 4 players are allowed for this game");var f;if(f=a.stateBeforeMove&&a.stateBeforeMove.board?t(d,c,a.stateAfterMove.delta,a.stateAfterMove):i(e),!angular.equals(b,f))return!1}catch(g){return!1}return!0}a.getInitialBoard=h,a.getInitialMove=i,a.createMoveEndGame=o,a.createMovePass=p,a.createMoveReveal=q,a.createMoveBuy=r,a.createMovePlay=s,a.createMove=t,a.isMoveOk=u}(gameLogic||(gameLogic={}));var game;!function(a){function b(){console.log("Translation of 'RULES_OF_TICTACTOE' is "+translate("RULES_OF_TICTACTOE")),resizeGameAreaService.setWidthToHeight(2),gameService.setGame({minNumberOfPlayers:2,maxNumberOfPlayers:2,isMoveOk:gameLogic.isMoveOk,updateUI:h}),$rootScope.hasGameEnded=!1,document.addEventListener("animationend",c,!1),document.addEventListener("webkitAnimationEnd",c,!1),document.addEventListener("oanimationend",c,!1)}function c(){$rootScope.$apply(function(){log.info("Animation ended"),I=!0,K&&f()})}function d(){return P[2]?2:P[3]?3:P[4]?4:P[5]?5:void 0}function e(){return P[8]?8:P[7]?7:P[6]?6:P[1]?1:P[0]?0:void 0}function f(){var a=g(!1,d()),b=g(!0,e());log.info("sendComputerMove(): Calling make move for computer move for left number: "+a+" and right number "+b),gameService.makeMove(aiService.createComputerMove(M,L,a,b))}function g(a,b){var c=L.board;if(void 0===c)return void 0;if(a){var d=z(!0,c.rightMost),e=-1===d?void 0:A(d,b),f=void 0===e?void 0:"regular"===e?L[c.rightMost].rightNumber:L[c.rightMost].leftNumber;return f}var g=z(!1,c.leftMost),h=-1===g?void 0:A(g,b),i=void 0===h?void 0:"regular"===h?L[c.leftMost].rightNumber:L[c.leftMost].leftNumber;return i}function h(a){if(I=!1,L=a.stateAfterMove,$rootScope.state=L,log.info("updateUI(): updating UI."),!L.board&&a.yourPlayerIndex===a.turnIndexAfterMove){var b=gameLogic.getInitialMove(a.numberOfPlayers);return log.info("updateUI(): make initial move. Calling makeMove "+JSON.stringify(b)),void gameService.makeMove(b)}if(J=a.turnIndexAfterMove>=0&&a.yourPlayerIndex===a.turnIndexAfterMove,M=a.turnIndexAfterMove,$rootScope.yourPlayerIndex=a.yourPlayerIndex,$rootScope.turnIndex=a.turnIndexAfterMove,L&&L.delta&&L.delta.play===Play.REVEAL){var c={play:Play.END};L.delta=c;var b=gameLogic.createMove(L,a.turnIndexAfterMove,c,L);return void gameService.makeMove(b)}if(L&&L.delta&&L.delta.play===Play.END)return $rootScope.hasGameEnded=!0,$rootScope.scores=a.endMatchScores,void($rootScope.yourPlayerIndex=a.turnIndexBeforeMove);if(J&&i(a.stateBeforeMove)&&i(a.stateAfterMove)){var c={play:Play.REVEAL},b=gameLogic.createMove(L,a.turnIndexAfterMove,c,L);return void gameService.makeMove(b)}K=J&&""===a.playersInfo[a.yourPlayerIndex].playerId,K&&(J=!1,f())}function i(a){return a&&a.delta&&a.delta.play&&a.delta.play===Play.PASS?!0:!1}function j(){if(log.info("Tried to pass"),J)try{var a=Play.PASS;$rootScope.selectedTile=void 0;var b=gameLogic.createMove(L,M,{play:a},L);J=!1,log.info("Making move to pass"),gameService.makeMove(b)}catch(c){return void log.error(["Cannot make play for tree:",treeId])}}function k(a){if(log.info(["Tried to make play for tree:",a]),"?throwException"===window.location.search)throw new Error("Throwing the error because URL has '?throwException'");if(J&&void 0!==$rootScope.selectedTile)try{var b=E(a)?Play.RIGHT:Play.LEFT,c=$rootScope.selectedTile;L.delta={play:b,tileKey:c};var d=gameLogic.createMove(L,M,{play:b,tileKey:c},L);J=!1,log.info("placeTileOnTree(): Making move to place tile on tree. Calling makeMove with move "+JSON.stringify(d)),$rootScope.selectedTile=void 0,gameService.makeMove(d)}catch(e){return void log.error(["Cannot make play for tree:",a])}}function l(a,b){return F(L.players[a].hand?L[L.players[a].hand[b]]:void 0)}function m(a){return L.players&&L.players[a]&&L.players[a].hand?r(L.players[a].hand.length):[]}function n(){return L&&L.players?L.players.length-1:1}function o(a){if(J&&L&&L.house&&L.house.hand[a])try{var b={play:Play.BUY,tileKey:L.house.hand[a]},c=gameLogic.createMove(L,M,b,L);J=!1,gameService.makeMove(c)}catch(d){return void log.error(["Cannot make buy play for tile:",a])}}function p(a){var b=L.players;if(!b)return[];for(var c=[],d=0;d<b.length;d++)d!=a&&c.push(d);return c}function q(){return L.house&&L.house.hand?r(L.house.hand.length):[]}function r(a){for(var b=[],c=0;a>c;c++)b.push(c);return b}function s(a,b){return!I&&L.delta&&L.delta.play===Play.BUY&&L.players[b].hand[a]===L.delta.tileKey}function t(a,b){if(I||!L.delta)return!1;var c=u(a,b);return c&&L.delta.tileKey===c.tileKey}function u(a,b){var c=L.board;if(!c||!c.root)return void 0;var d;if(0===b){if(0!=a)return void 0;d=c.root}else{var e=1;for(d=E(b)?c.root.rightTile:c.root.leftTile;e!==a&&void 0!==d;)e++,d=E(b)?d.rightTile:d.leftTile}return d}function v(a,b){var c=u(a,b);return!(void 0===c)}function w(a){$rootScope.selectedTile=L.players[$rootScope.yourPlayerIndex].hand[a]}function x(a){$rootScope.tile=L.house.hand[a]}function y(a){return 1===a?0:6===a?1:7===a?6:2===a?0:3===a?2:4===a?3:5===a?4:void 0}function z(a,b){if(void 0===L.board||void 0===L.board.root)return-1;var c=L.board;if(c.root.tileKey===b)return 0;for(var d=1,e=a?c.root.rightTile:c.root.leftTile;e.tileKey!=b;)d+=1,e=a?e.rightTile:e.leftTile;return d}function A(a,b){if(P[b]&&P[b][a])return P[b][a];var c=L.board;if(c.leftMost===c.root.tileKey&&c.rightMost===c.root.tileKey){var d="regular";return P[b]=[],P[b][a]=d,d}for(var e=c.root,f=!1,g=1,h=E(b)?c.root.rightTile:c.root.leftTile;g!==a&&void 0!==h;)e=h,g++,h=E(b)?h.rightTile:h.leftTile;h=void 0===h?void 0:L[h.tileKey],e=void 0===e?void 0:L[e.tileKey];var i=!1;if(P[b])i="flipped"===P[b][a-1];else{var j=y(b);i="flipped"===P[j][a-1]}void 0!==h&&(!i&&e.leftNumber>=e.rightNumber?h.rightNumber===e.leftNumber&&h.rightNumber>h.leftNumber?f=!0:h.leftNumber===e.leftNumber&&h.leftNumber>h.rightNumber&&(f=!0):!i&&e.rightNumber>=e.leftNumber?h.rightNumber===e.rightNumber&&h.rightNumber>h.leftNumber?f=!0:h.leftNumber===e.rightNumber&&h.leftNumber>h.rightNumber&&(f=!0):i&&e.rightNumber<=e.leftNumber?h.rightNumber===e.rightNumber&&h.rightNumber>h.leftNumber?f=!0:h.leftNumber===e.rightNumber&&h.leftNumber>h.rightNumber&&(f=!0):i&&e.leftNumber<=e.rightNumber&&(h.rightNumber===e.leftNumber&&h.rightNumber>h.leftNumber?f=!0:h.leftNumber===e.leftNumber&&h.leftNumber>h.rightNumber&&(f=!0)));var d=f?"flipped":"regular";return P[b]||(P[b]=[]),P[b][a]=d,d}function B(a,b,c){if(O[b]&&O[b][a])return c===O[b][a];var d=A(a,b),e=C(b,"flipped"===d);return O[b]||(O[b]=[]),O[b][a]=e,e===c}function C(a,b){return 0===a?"rootTile":1===a?b?"horizontalTile":"horizontalTileFlip":2===a?b?"horizontalTileFlip":"horizontalTile":3===a||4===a?b?"maxWidthHeightTileFlip":"maxWidthHeightTile":5===a?b?"tree5Tile":"tree5TileFlip":6===a?b?"maxWidthHeightTile":"maxWidthHeightTileFlip":7===a?b?"tree5TileFlip":"tree5Tile":void 0}function D(a,b){var c=L.board;if(N[b]&&N[b][a])return N[b][a];if(c.leftMost===c.root.tileKey&&c.rightMost===c.root.tileKey){var d=F(L[c.root.tileKey]);return N[b]=[],N[b][a]=d,d}for(var e=1,f=E(b)?c.root.rightTile:c.root.leftTile;e!==a&&void 0!==f;)e++,f=E(b)?f.rightTile:f.leftTile;f=void 0===f?void 0:L[f.tileKey];var d=F(void 0===f?void 0:f);return N[b]||(N[b]=[]),N[b][a]=d,d}function E(a){return 0===a||1===a||6===a||7===a||8===a}function F(a){return void 0===a||null===a?"imgs/dominoes/domino-blank.svg":a.leftNumber<=a.rightNumber?"imgs/dominoes/domino-"+a.leftNumber+"-"+a.rightNumber+".svg":"imgs/dominoes/domino-"+a.rightNumber+"-"+a.leftNumber+".svg"}function G(a){var b=$rootScope.scores;return""+b[a]}function H(a){return"imgs/player/image"+a+".svg"}var I=!1,J=!1,K=!1,L=null,M=null,N=[],O=[],P=[];document.getElementById("gameArea"),document.getElementById("currentPlayer");a.isHelpModalShown=!1,a.init=b,a.passPlay=j,a.placeTileOnTree=k,a.getTileImageSourceForPlayer=l,a.getNumberOfTilesForPlayer=m,a.getNumberOfPlayers=n,a.makeBuyPlay=o,a.getOpponentIds=p,a.getNumberOfTilesForBoneYard=q,a.shouldSlowlyAppear=s,a.shouldEnlarge=t,a.shouldShowImage=v,a.registerSelectedPlayerTile=w,a.registerSelectedHouseTile=x,a.getTileLevel=z,a.getTileOrientation=A,a.getImageClass=B,a.getImageSource=D,a.getFinalScore=G,a.getPlayerIconSource=H}(game||(game={})),angular.module("myApp",["ngTouch","ui.bootstrap","gameServices"]).run(function(){$rootScope.game=game,translate.setLanguage("en",{RULES_OF_TICTACTOE:"Rules of Dominoes",RULES_SLIDE1:"This game is played according to the draw rules. The first player to join the game who has a double places the first domino. If you don't have a double tile, click on pass",RULES_SLIDE2:"Each player adds a domino to an open end of the layout, if he/she can. The layout flows left/right as necessary.",RULES_SLIDE3:"If a player is unable to make a move, he/she must draw dominoes from the boneyard until he can make a move. If there are no dominoes left, then the player must pass.",RULES_SLIDE4:"A game ends either when a player plays all his/her tiles, or when a game is blocked. A game is blocked when no player is able to add another tile to the layout.",RULES_SLIDE5:"When a hand ends, the player with the lightest hand (i.e. the fewest number of dots on their dominoes) wins the number of sum total of points in all of his opponents hands (minus the points in his own hand, if any)",PASS:"PASS",CLOSE:"Close"}),game.init()});var aiService;!function(a){function b(a,b,d,e){for(var f=b.board,g=b.players[a].hand,h=b.house?b.house.hand.length:0,i=void 0,j=void 0,k=0;k<g.length;k++)if(f&&f.root?j=c(b[g[k]],d,e):b[g[k]].leftNumber===b[g[k]].rightNumber&&(j=Play.RIGHT),void 0!==j){i=g[k];break}void 0===j&&(f&&f.root&&0!=h?(j=Play.BUY,i=b.house.hand[0]):j=Play.PASS);var l=j!==Play.PASS?{tileKey:i,play:j}:{play:j};b.delta=l;var m=gameLogic.createMove(b,a,l,b);return m}function c(a,b,c){return a.leftNumber===b||a.rightNumber===b?Play.LEFT:a.leftNumber===c||a.rightNumber===c?Play.RIGHT:void 0}a.createComputerMove=b}(aiService||(aiService={}));
//# sourceMappingURL=everything.min.js.map